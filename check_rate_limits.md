# Проверка лимитов Z.AI API

## Как проверить текущие лимиты

1. **Веб-интерфейс:**
   - Перейдите на https://z.ai/manage-apikey/rate-limits
   - Войдите с вашими учетными данными
   - Посмотрите текущие лимиты concurrency для каждой модели

2. **Billing и баланс:**
   - https://z.ai/manage-apikey/billing
   - Проверьте текущий баланс и расходы

## Текущая конфигурация

**Модель:** glm-4.5-air  
**Max tokens:** 500 (уменьшено с 1000)  
**Temperature:** 0.1  
**Timeout:** 60 секунд  

## Типичное время обработки

По логам видно:
- **18-27 секунд** - обычное время ответа API
- Это включает:
  - Время отправки запроса
  - Обработку на стороне Z.AI
  - Генерацию ответа
  - Получение ответа

## Факторы, влияющие на скорость

1. **Размер промпта:**
   - Наш промпт ~3000-4000 символов (большой системный промпт с примерами)
   - Можно сократить для более быстрой обработки

2. **Max tokens:**
   - Уменьшен до 500 (было 1000)
   - Для JSON ответа достаточно

3. **Concurrency лимиты:**
   - Если превышаем лимит, Z.AI может замедлять обработку
   - Проверьте текущий лимит на сайте

4. **Нагрузка на API:**
   - Общая нагрузка на инфраструктуру Z.AI
   - Время суток (пиковые часы)

## Рекомендации для ускорения

### 1. Сократить промпт
Текущий промпт содержит много примеров. Можно:
- Убрать часть примеров
- Сократить инструкции
- Убрать малоиспользуемые поля

### 2. Проверить лимиты
```bash
# Проверьте на сайте:
https://z.ai/manage-apikey/rate-limits

# Обычно для glm-4.5-air лимит выше, чем для glm-4.6
```

### 3. Мониторинг
После изменений проверяйте:
```bash
docker-compose logs app | grep "API call:" | tail -20
```

Это покажет:
- Время обработки
- Количество токенов
- Модель

### 4. Альтернативы
Если скорость критична:
- Использовать glm-4-flash (самая быстрая модель)
- Кешировать результаты для дубликатов
- Батчить запросы (если поддерживается)

## Текущая ситуация

**Проблема:** 18-27 секунд на обработку одного сообщения

**Возможные причины:**
1. ✅ Большой промпт (~3-4K символов)
2. ❓ Throttling из-за лимитов (нужно проверить на сайте)
3. ✅ Модель glm-4.5-air медленнее, чем flash-модели
4. ❓ Общая нагрузка на Z.AI API

**Следующие шаги:**
1. Проверить текущий лимит concurrency на сайте
2. Сократить промпт (убрать примеры)
3. Рассмотреть переход на glm-4-flash
4. Добавить мониторинг частоты запросов
