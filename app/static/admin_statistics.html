<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--tg-theme-text-color, #000000);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--tg-theme-hint-color, #666666);
            font-size: 14px;
        }

        .status-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--tg-theme-text-color, #000000);
        }

        .section {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section h2 {
            color: var(--tg-theme-text-color, #000000);
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--tg-theme-button-color, #007bff);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #666666);
        }

        .chart-container {
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            min-height: 300px;
            height: auto;
        }

        .chart-title {
            font-size: 14px;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 10px;
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #28a745;
        }

        .status-offline {
            background: #dc3545;
        }

        .status-warning {
            background: #ffc107;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--tg-theme-hint-color, #666666);
        }

        .refresh-btn {
            background: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .refresh-btn:hover {
            background: var(--tg-theme-button-color, #0056b3);
        }

        .refresh-btn:disabled {
            background: var(--tg-theme-hint-color, #666666);
            cursor: not-allowed;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h1>
            <div class="status-row">
                <div class="status-item">
                    <span class="status-indicator" id="bot-status-indicator"></span>
                    <span id="bot-status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator" id="parsing-status-indicator"></span>
                    <span id="parsing-status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
            </div>
        </div>

        <div id="message-container"></div>


        <!-- Main Statistics -->
        <div class="section">
            <h2>üìà –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-posts">-</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="parsed-ads">-</div>
                    <div class="stat-label">–†–∞—Å–ø–∞—Ä—Å–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="non-real-estate">-</div>
                    <div class="stat-label">–ù–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="duplicates">-</div>
                    <div class="stat-label">–î—É–±–ª–∏–∫–∞—Ç—ã</div>
                </div>
            </div>
        </div>

        <!-- Processing Statistics -->
        <div class="section">
            <h2>‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="matched-filters">-</div>
                    <div class="stat-label">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="forwarded-ads">-</div>
                    <div class="stat-label">–ü–µ—Ä–µ—Å–ª–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="registered-users">-</div>
                    <div class="stat-label">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-channels">-</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤</div>
                </div>
            </div>
        </div>

        <!-- LLM Costs Statistics -->
        <div class="section">
            <h2>üí∞ –†–∞—Å—Ö–æ–¥—ã –Ω–∞ LLM</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-cost">-</div>
                    <div class="stat-label">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã ($)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="today-cost">-</div>
                    <div class="stat-label">–°–µ–≥–æ–¥–Ω—è ($)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-daily-cost">-</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–¥–Ω–µ–≤–Ω—ã–µ ($)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="llm-requests">-</div>
                    <div class="stat-label">–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="section">
            <h2>üìä –ì—Ä–∞—Ñ–∏–∫–∏</h2>
            
            <div class="chart-container">
                <div class="chart-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</div>
                <canvas id="statusChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)</div>
                <canvas id="dailyChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ LLM –ø–æ –¥–Ω—è–º</div>
                <canvas id="costsChart"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">–¢–æ–ø –∫–∞–Ω–∞–ª–æ–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                <canvas id="channelsChart"></canvas>
            </div>
        </div>

        <button class="refresh-btn" onclick="loadAllData()" id="refresh-btn">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
    </div>

    <script>
        // Telegram Web App initialization
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // API base URL
        let API_BASE = window.location.origin + '/api/v1';

        // JWT Auth (for future protected endpoints)
        let accessToken = null;

        async function authenticate() {
            try {
                const initData = tg.initData;
                if (!initData) return false;

                const response = await fetch('/api/v1/auth/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ init_data: initData })
                });

                if (!response.ok) return false;

                const data = await response.json();
                accessToken = data.access_token;
                return true;
            } catch (error) {
                console.error('Authentication error:', error);
                return false;
            }
        }

        // DOM elements
        const messageContainer = document.getElementById('message-container');
        const statusIndicator = document.getElementById('status-indicator');
        const refreshBtn = document.getElementById('refresh-btn');

        // Chart instances
        let statusChart = null;
        let dailyChart = null;
        let costsChart = null;
        let channelsChart = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            await authenticate();
            loadAllData();
        });

        async function loadAllData() {
            try {
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...';
                
                await Promise.all([
                    loadStatistics(),
                    loadDailyStats(),
                    loadCostsStats(),
                    loadChannelStats()
                ]);
                
                showMessage('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ';
            }
        }

        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics/`);
                if (!response.ok) throw new Error('Failed to load statistics');
                
                const stats = await response.json();
                
                // Update main statistics
                document.getElementById('total-posts').textContent = stats.total_posts || 0;
                document.getElementById('parsed-ads').textContent = stats.parsed_ads || 0;
                document.getElementById('non-real-estate').textContent = stats.non_real_estate || 0;
                document.getElementById('duplicates').textContent = stats.duplicates || 0;
                document.getElementById('matched-filters').textContent = stats.matched_filters || 0;
                document.getElementById('forwarded-ads').textContent = stats.forwarded_ads || 0;
                document.getElementById('registered-users').textContent = stats.registered_users || 0;
                document.getElementById('active-channels').textContent = stats.active_channels || 0;
                
                // Update system status
                const botStatus = stats.bot_status === 'active' ? '–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω' : '–ë–æ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω';
                const parsingStatus = stats.parsing_status === 'active' ? '–ü–∞—Ä—Å–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω' : '–ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω';
                
                document.getElementById('bot-status-text').textContent = botStatus;
                document.getElementById('parsing-status-text').textContent = parsingStatus;
                
                // Update status indicators
                const botStatusIndicator = document.getElementById('bot-status-indicator');
                const parsingStatusIndicator = document.getElementById('parsing-status-indicator');
                
                if (stats.bot_status === 'active') {
                    botStatusIndicator.className = 'status-indicator status-online';
                } else {
                    botStatusIndicator.className = 'status-indicator status-offline';
                }
                
                if (stats.parsing_status === 'active') {
                    parsingStatusIndicator.className = 'status-indicator status-online';
                } else {
                    parsingStatusIndicator.className = 'status-indicator status-offline';
                }
                
                // Create status chart
                createStatusChart(stats);
                
            } catch (error) {
                console.error('Error loading statistics:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
            }
        }

        async function loadDailyStats() {
            try {
                const response = await fetch(`${API_BASE}/statistics/daily`);
                if (!response.ok) throw new Error('Failed to load daily stats');
                
                const dailyData = await response.json();
                createDailyChart(dailyData);
            } catch (error) {
                console.error('Error loading daily stats:', error);
                // Fallback to mock data if API fails
                const mockDailyData = generateMockDailyData();
                createDailyChart(mockDailyData);
            }
        }

        async function loadCostsStats() {
            try {
                const response = await fetch(`${API_BASE}/statistics/llm-costs`);
                if (!response.ok) throw new Error('Failed to load LLM costs');
                
                const costsData = await response.json();
                
                // Update cost statistics
                document.getElementById('total-cost').textContent = costsData.total_cost.toFixed(2);
                document.getElementById('today-cost').textContent = costsData.today_cost.toFixed(2);
                document.getElementById('avg-daily-cost').textContent = costsData.avg_daily_cost.toFixed(2);
                document.getElementById('llm-requests').textContent = costsData.requests;
                
                createCostsChart(costsData);
            } catch (error) {
                console.error('Error loading costs stats:', error);
                // Fallback to mock data if API fails
                const mockCostsData = generateMockCostsData();
                
                document.getElementById('total-cost').textContent = mockCostsData.total.toFixed(2);
                document.getElementById('today-cost').textContent = mockCostsData.today.toFixed(2);
                document.getElementById('avg-daily-cost').textContent = mockCostsData.avgDaily.toFixed(2);
                document.getElementById('llm-requests').textContent = mockCostsData.requests;
                
                createCostsChart(mockCostsData);
            }
        }

        async function loadChannelStats() {
            try {
                const response = await fetch(`${API_BASE}/statistics/channel-activity`);
                if (!response.ok) throw new Error('Failed to load channel activity');
                
                const channels = await response.json();
                createChannelsChart(channels);
            } catch (error) {
                console.error('Error loading channel stats:', error);
                // Fallback to empty state
                createChannelsChart([]);
            }
        }

        function createStatusChart(stats) {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            if (statusChart) {
                statusChart.destroy();
            }
            
            statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['–†–∞—Å–ø–∞—Ä—Å–µ–Ω–æ', '–ù–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', '–î—É–±–ª–∏–∫–∞—Ç—ã'],
                    datasets: [{
                        data: [
                            stats.parsed_ads || 0,
                            stats.non_real_estate || 0,
                            stats.duplicates || 0
                        ],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#6c757d'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createDailyChart(mockData) {
            const ctx = document.getElementById('dailyChart').getContext('2d');
            
            if (dailyChart) {
                dailyChart.destroy();
            }
            
            dailyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: mockData.labels,
                    datasets: [{
                        label: '–°–æ–æ–±—â–µ–Ω–∏–π',
                        data: mockData.messages,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: '–û–±—ä—è–≤–ª–µ–Ω–∏–π',
                        data: mockData.ads,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createCostsChart(costsData) {
            const ctx = document.getElementById('costsChart').getContext('2d');
            
            if (costsChart) {
                costsChart.destroy();
            }
            
            costsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: costsData.labels,
                    datasets: [{
                        label: '–†–∞—Å—Ö–æ–¥—ã ($)',
                        data: costsData.daily_costs || costsData.costs,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createChannelsChart(channels) {
            const ctx = document.getElementById('channelsChart').getContext('2d');
            
            if (channelsChart) {
                channelsChart.destroy();
            }
            
            if (!channels || channels.length === 0) {
                // Show empty state
                channelsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'],
                        datasets: [{
                            label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                            data: [0],
                            backgroundColor: '#6c757d',
                            borderColor: '#495057',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                return;
            }
            
            // Use real channel activity data
            const sortedChannels = channels.slice(0, 5); // Top 5 channels
            
            // Define colors for each channel
            const channelColors = [
                '#007bff', // Blue
                '#28a745', // Green
                '#ffc107', // Yellow
                '#dc3545', // Red
                '#6f42c1'  // Purple
            ];
            
            // Create datasets for each channel
            const datasets = sortedChannels.map((channel, index) => {
                const shortTitle = channel.channel_title && channel.channel_title.length > 20 
                    ? channel.channel_title.substring(0, 20) + '...' 
                    : channel.channel_title || 'Unknown';
                const username = channel.channel_username ? `@${channel.channel_username}` : 'unknown';
                
                return {
                    label: `${shortTitle} (${username})`,
                    data: Array(sortedChannels.length).fill(0).map((_, i) => i === index ? channel.message_count : 0),
                    backgroundColor: channelColors[index % channelColors.length],
                    borderColor: channelColors[index % channelColors.length],
                    borderWidth: 1
                };
            });
            
            channelsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedChannels.map(ch => ch.message_count.toString()),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 1.5,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–°–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 10
                                },
                                boxWidth: 12,
                                boxHeight: 12
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const datasetIndex = context[0].datasetIndex;
                                    return datasets[datasetIndex].label;
                                },
                                label: function(context) {
                                    return `–°–æ–æ–±—â–µ–Ω–∏–π: ${context.parsed.y}`;
                                }
                            }
                        }
                    },
                    layout: {
                        padding: {
                            bottom: 50
                        }
                    }
                }
            });
            
            // Dynamically adjust container height based on legend
            setTimeout(() => {
                const chartContainer = document.getElementById('channelsChart').closest('.chart-container');
                if (chartContainer) {
                    const legendHeight = 100; // Approximate height for legend
                    const newHeight = Math.max(300, 200 + legendHeight);
                    chartContainer.style.height = newHeight + 'px';
                }
            }, 100);
        }

        function generateMockDailyData() {
            const labels = [];
            const messages = [];
            const ads = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric' }));
                
                messages.push(Math.floor(Math.random() * 50) + 10);
                ads.push(Math.floor(Math.random() * 20) + 5);
            }
            
            return { labels, messages, ads };
        }

        function generateMockCostsData() {
            const labels = [];
            const costs = [];
            let total = 0;
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric' }));
                
                const dailyCost = Math.random() * 5 + 0.5; // $0.5 - $5.5 per day
                costs.push(parseFloat(dailyCost.toFixed(2)));
                total += dailyCost;
            }
            
            const today = costs[costs.length - 1];
            const avgDaily = total / costs.length;
            const requests = Math.floor(total * 20) + 50; // Rough estimate
            
            return {
                labels,
                costs,
                total: parseFloat(total.toFixed(2)),
                today: parseFloat(today.toFixed(2)),
                avgDaily: parseFloat(avgDaily.toFixed(2)),
                requests
            };
        }

        function showMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = text;
            
            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
